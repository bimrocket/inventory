<div class="main-content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-12">
        <h3>{{'AGREMIATS.TITLE' | translate }}</h3>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <button [disabled]="!curUser.hasPermission(FUNCIONALITIES.GUILD_MANAGEMENT)" [routerLink]="['/gestio-gremi/agremiats/new']"
          mat-raised-button color="primary">
          {{ 'GENERAL.ADD' | translate }}
          <i class="material-icons">
            add_circle
          </i>
        </button>
      </div>
    </div>
    <div class="row card">
      <div class="col-lg-12">
        <div class="card-header-warning">
          {{ 'AGREMIATS.FILTER' | translate }}

        </div>
        <div class="card-body">
          <form [formGroup]="formSearch" (ngSubmit)="search()">
            <div class="row">
              <div class="col-lg-4">
                <mat-form-field>
                    <mat-select formControlName="idMember" placeholder="{{ 'AGREMIATS.NOMEMP' | translate }}">
                      <mat-option *ngFor="let member of membersAll" [value]="member.memberId">
                        {{ member.companyName }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
              </div>
              <div class="col-lg-4">
                <mat-form-field>
                  <input formControlName="cif" matInput placeholder="{{ 'AGREMIATS.DNI' | translate }}">
                </mat-form-field>
              </div>
              <div class="col-lg-4">
                <mat-form-field>
                  <input formControlName="agremiat" matInput placeholder="{{ 'AGREMIATS.NOMAGREM' | translate }}">
                </mat-form-field>
              </div>
            </div>
            <div class="row">
              <div class="col-lg-4">
                <mat-form-field>
                  <mat-select formControlName="guild" placeholder="{{ 'AGREMIATS.NOMGUILD' | translate }}">
                    <mat-option *ngFor="let guild of guilds" [value]="guild.gremiId">
                      {{ guild.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div class="col-lg-4">
                <mat-form-field>
                  <input formControlName="email" matInput placeholder="{{ 'AGREMIATS.EMAIL' | translate }}">
                </mat-form-field>
              </div>
            </div>
            <div class="row">
              <div class="col-lg-12">
              <button mat-raised-button style="float:right;" color="primary" type="submit">
                  {{ 'GENERAL.SEARCH' | translate }}
                </button>
                <button mat-raised-button [disabled]="exportInProgress" (click)="exportAgremiats()" style="float:right;margin-right: 40px;" color="primary">
                  {{ 'GENERAL.EXPORT_EXCEL' | translate }}
                </button>
                
                <button mat-stroked-button color="accent" style="float: right;margin-right:40px;" (click)="clearInputs()"> {{ 'GENERAL.CLEAR' | translate }}</button>

              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="row card">
      <div class="col-lg-12" *ngIf="loadingMembers">
        <mat-spinner style="margin: 0 auto;"></mat-spinner>
      </div>
      <div class="col-lg-12" *ngIf="!loadingMembers">
        <div class="card-header-warning">
          {{ 'AGREMIATS.LISTGREMIS' | translate }}
        </div>
        <table class="table card-body text-center">
          <thead>
            <tr>
              <th scope="col">{{ 'AGREMIATS.NOMEMP' | translate }}</th>
              <th scope="col">{{ 'AGREMIATS.EMAIL' | translate }}</th>
              <th scope="col">{{ 'AGREMIATS.NOMAGREM' | translate }}</th>
              <th scope="col">{{ 'AGREMIATS.DNI' | translate }}</th>
              <th scope="col">{{ 'AGREMIATS.AGREMIAT_TYPE' | translate }}</th>
              <th scope="col">{{ 'AGREMIATS.COD_SEGURITY' | translate }}</th>
              <th scope="col" class="col-accions">{{ 'GREMIS.ACTIONS' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="members == undefined || members.length == 0">
              <td colspan="12" class="text-center">
                <h4>{{ 'GENERAL.NOT_EMPTY' | translate}}</h4>
              </td>
            </tr>
            <tr *ngFor="let agremiat of members">
              <td scope="row">{{ agremiat.companyName }}</td>
              <td scope="row">{{ agremiat.email }}</td>
              <td scope="row">{{ agremiat.memberName }}</td>
              <td scope="row">{{ agremiat.dni }}</td>
              <td scope="row">{{ getNomType(agremiat.agremiatType) }}</td>
              <td scope="row">{{ agremiat.securityCode }}</td>
              <td scope="row">
                <button [disabled]="!curUser.hasPermission(FUNCIONALITIES.GUILD_MANAGEMENT)" class="buttonIcon" [routerLink]="['/gestio-gremi/agremiats/'+agremiat.memberId]"
                  mat-button>
                  <i class="material-icons">
                    edit
                  </i>
                </button>
                <button [disabled]="!curUser.hasPermission(FUNCIONALITIES.GUILD_MANAGEMENT)" 
                 class="marginLeft15px buttonIcon" mat-button
                  (click)="deleteAgremiat(agremiat.memberId)" *ngIf="agremiat.deletedDate == null">
                  <i class="material-icons">
                    delete
                  </i>
                </button> 
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>